<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrix Org Chart</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reactflow@11.10.1/dist/umd/index.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reactflow@11.10.1/dist/style.css" />
    
    <style>
        /* 重要：強制讓 body 和 root 撐開全螢幕 */
        html, body, #root { 
            width: 100%; 
            height: 100%; 
            margin: 0; 
            padding: 0; 
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .header-info { 
            padding: 10px; 
            background: #eee; 
            font-size: 14px; 
            border-bottom: 1px solid #ccc;
        }
        /* 這是 React Flow 的容器，必須有明確高度 */
        #flow-wrapper { 
            flex-grow: 1; 
            width: 100%;
            height: calc(100vh - 40px); 
        }
        .highlight { border: 2px solid #3498db !important; background: #ebf5fb !important; }
        .dimmed { opacity: 0.3; }
    </style>
</head>
<body>
    <div class="header-info">點擊方塊觸發邏輯亮起 (請稍等 1-2 秒加載)</div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useCallback } = React;
        const ReactFlow = window.ReactFlow.default;
        const { Background, Controls, applyEdgeChanges, applyNodeChanges } = window.ReactFlow;

        const initialNodes = [
            { id: '1', data: { label: 'RD 部門', group: 'admin' }, position: { x: 250, y: 50 } },
            { id: '2', data: { label: '技術週會', group: 'meeting' }, position: { x: 100, y: 150 } },
            { id: '3', data: { label: '專案週會', group: 'meeting' }, position: { x: 400, y: 150 } }
        ];

        function App() {
            const [nodes, setNodes] = useState(initialNodes);
            const [edges, setEdges] = useState([]);

            const onNodeClick = (event, clickedNode) => {
                // 自定義函數邏輯範例：點擊一個，同 group 的全亮
                const targetGroup = clickedNode.data.group;
                setNodes((nds) => nds.map((n) => ({
                    ...n,
                    className: n.data.group === targetGroup ? 'highlight' : 'dimmed'
                })));
            };

            const onPaneClick = () => {
                setNodes((nds) => nds.map((n) => ({ ...n, className: '' })));
            };

            return (
                <div id="flow-wrapper">
                    <ReactFlow
                        nodes={nodes}
                        edges={edges}
                        onNodesChange={(chs) => setNodes((nds) => applyNodeChanges(chs, nds))}
                        onNodeClick={onNodeClick}
                        onPaneClick={onPaneClick}
                        fitView
                    >
                        <Background />
                        <Controls />
                    </ReactFlow>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>